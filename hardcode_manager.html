<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hardcoded Response Manager</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    h1, h2 {
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
    }
    th {
      background: #2c3e50;
      color: white;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, textarea, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 10px 15px;
      border: none;
      background: #3498db;
      color: white;
      cursor: pointer;
      border-radius: 4px;
      margin-right: 10px;
    }
    button:hover {
      background: #2980b9;
    }
  </style>
</head>
<body>
  <h1>ðŸ§  Hardcoded Response Manager</h1>

  <label for="user-question">User Question</label>
  <textarea id="user-question" rows="2" placeholder="Enter the user's question..."></textarea>

  <label for="ai-response">AI Response</label>
  <textarea id="ai-response" rows="3" placeholder="Enter the AI response..."></textarea>

  <label for="response-role">Response Role</label>
  <select id="response-role">
    <option value="patient">Patient</option>
    <option value="proctor">Proctor</option>
  </select>

  <label for="media-trigger">Media Trigger (optional - filename only)</label>
  <input type="text" id="media-trigger" placeholder="e.g. scene1.png" />

  <button id="save-button">âœ… Save</button>
  <button id="refresh-button">ðŸ”„ Refresh</button>

  <h2>Unreviewed Questions</h2>
  <table>
    <thead>
      <tr>
        <th>User Question</th>
        <th>AI Response</th>
        <th>Role</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="hardcode-table"></tbody>
  </table>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <!-- Firebase Config -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAmpYL8Ywfxkw_h2aMvF2prjiI0m5LYM40",
      authDomain: "ems-code-sim.firebaseapp.com",
      databaseURL: "https://ems-code-sim-default-rtdb.firebaseio.com",
      projectId: "ems-code-sim",
      storageBucket: "ems-code-sim.firebasestorage.app",
      messagingSenderId: "190498607578",
      appId: "1:190498607578:web:4cf6c8e999b027956070e3",
      measurementId: "G-2Q3ZT01YT1"
    };

    firebase.initializeApp(firebaseConfig);
  </script>

  <!-- Manager Logic -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const logRef = firebase.database().ref('unknownQuestions');
      const hardcodedRef = firebase.database().ref('hardcodedResponses');

      const table = document.getElementById('hardcode-table');
      const saveBtn = document.getElementById('save-button');
      const refreshBtn = document.getElementById('refresh-button');

      let editingRow = null;

      refreshBtn.addEventListener('click', loadUnapproved);

      saveBtn.addEventListener('click', () => {
        const userQuestion = document.getElementById('user-question').value.trim();
        const aiResponse = document.getElementById('ai-response').value.trim();
        const role = document.getElementById('response-role').value;
        const mediaTrigger = document.getElementById('media-trigger').value.trim();

        if (!userQuestion || !aiResponse) {
          alert('Question and response are required.');
          return;
        }

        const entry = {
          userQuestion,
          aiResponse,
          role,
          reviewed: true,
          timestamp: Date.now()
        };

        if (mediaTrigger) {
          entry.mediaTrigger = mediaTrigger;
        }

        hardcodedRef.push(entry);

        if (editingRow?.logKey) {
          logRef.child(editingRow.logKey).update({ reviewed: true });
        }

        clearForm();
        loadUnapproved();
      });

      function clearForm() {
        document.getElementById('user-question').value = '';
        document.getElementById('ai-response').value = '';
        document.getElementById('media-trigger').value = '';
        document.getElementById('response-role').value = 'patient';
        editingRow = null;
      }

      function loadUnapproved() {
        table.innerHTML = '';
        logRef.orderByChild('reviewed').equalTo(false).once('value', snapshot => {
          snapshot.forEach(child => {
            const data = child.val();
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${data.userQuestion}</td>
              <td>${data.aiResponse}</td>
              <td>${data.role}</td>
              <td><button class="edit-btn">Edit</button></td>
            `;
            row.querySelector('.edit-btn').addEventListener('click', () => {
              document.getElementById('user-question').value = data.userQuestion || '';
              document.getElementById('ai-response').value = data.aiResponse || '';
              document.getElementById('response-role').value = data.role || 'patient';
              document.getElementById('media-trigger').value = data.mediaTrigger || '';
              editingRow = { logKey: child.key };
            });
            table.appendChild(row);
          });
        });
      }

      loadUnapproved();
    });
  </script>
</body>
</html>
