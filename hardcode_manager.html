<!DOCTYPE html>
<html>
<head>
  <title>Hardcoded Response Manager</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { margin-bottom: 10px; }
    .response-container { display: flex; flex-direction: column; gap: 10px; }
    .response-box { display: flex; align-items: center; gap: 10px; border: 1px solid #ccc; padding: 10px; border-radius: 5px; }
    textarea { width: 250px; height: 60px; }
    select, button { height: 30px; }
    .actions { display: flex; flex-direction: column; gap: 5px; }
  </style>
</head>
<body>
  <h1>Hardcoded Response Manager</h1>
  <button onclick="loadUnapproved()">Load Unapproved</button>
  <button onclick="loadApproved()">Load All Approved</button>
  <div class="response-container" id="responseContainer"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAmpYL8Ywfxkw_h2aMvF2prjiI0m5LYM40",
      authDomain: "ems-code-sim.firebaseapp.com",
      databaseURL: "https://ems-code-sim-default-rtdb.firebaseio.com",
      projectId: "ems-code-sim",
      storageBucket: "ems-code-sim.firebasestorage.app",
      messagingSenderId: "190498607578",
      appId: "1:190498607578:web:4cf6c8e999b027956070e3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    async function loadResponses(showAll = false) {
      const container = document.getElementById("responseContainer");
      container.innerHTML = "";
      const snapshot = await db.ref("unknownQuestions").once("value");
      const entries = snapshot.val();
      for (let key in entries) {
        const entry = entries[key];
        if (!showAll && entry.reviewed) continue;

        const div = document.createElement("div");
        div.className = "response-box";

        const questionInput = document.createElement("textarea");
        questionInput.value = entry.userMessage ? entry.userMessage : (entry.userQuestion || "");

        const responseInput = document.createElement("textarea");
        responseInput.value = entry.aiResponse || "";

        const roleSelect = document.createElement("select");
        ["patient", "proctor"].forEach(role => {
          const opt = document.createElement("option");
          opt.value = role;
          opt.textContent = role;
          if (entry.responder === role) opt.selected = true;
          roleSelect.appendChild(opt);
        });

        const actions = document.createElement("div");
        actions.className = "actions";

        const approveBtn = document.createElement("button");
        approveBtn.textContent = "Approve & Save";
        approveBtn.onclick = async () => {
          const newEntry = {
            userQuestion: questionInput.value,
            aiResponse: responseInput.value,
            role: roleSelect.value,
            audioUrl: ""
          };
          await db.ref("hardcodedResponses").push(newEntry);
          await db.ref("unknownQuestions/" + key).remove();
          loadResponses(showAll);
        };

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "Delete";
        deleteBtn.onclick = async () => {
          await db.ref("unknownQuestions/" + key).remove();
          loadResponses(showAll);
        };

        actions.appendChild(approveBtn);
        actions.appendChild(deleteBtn);

        div.appendChild(questionInput);
        div.appendChild(responseInput);
        div.appendChild(roleSelect);
        div.appendChild(actions);

        container.appendChild(div);
      }
    }

    function loadUnapproved() { loadResponses(false); }
    function loadApproved() { loadResponses(true); }

    window.onload = loadUnapproved;
  </script>
</body>
</html>


