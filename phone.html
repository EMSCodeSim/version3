<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EMS Simulator (Mobile)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    /* (All your mobile CSS styles, as before) */
    /* ... [use your preferred CSS here] ... */
  </style>
  <script src="app.js"></script>
  <script src="router.js"></script>
  <script src="grading.js"></script>
</head>
<body>
  <div id="header" style="display:none;">
    <div id="scenario-title"></div>
    <span id="live-badge">Live</span>
  </div>
  <div id="chat"></div>
  <button id="skill-sheet-btn" onclick="showSkillSheet()" style="display:none;">‚úîÔ∏è Skill Sheet</button>
  <div id="skill-sheet-panel">
    <button id="close-skill-sheet" onclick="closeSkillSheet()">Close</button>
    <h3>Medical Assessment Skill Sheet</h3>
    <div id="skill-rows"></div>
  </div>
  <div id="input-bar" style="display:none;">
    <button id="mic-btn" title="Record voice" onclick="startMic()">üé§</button>
    <input id="user-input" placeholder="Type or say your assessment..." autocomplete="off" />
    <button id="send-btn" onclick="sendInput()">Send</button>
  </div>
  <div id="landing">
    <h2>Choose a Scenario</h2>
    <select id="scenario-select">
      <option value="" disabled selected>Select scenario...</option>
      <option value="chest_pain_002">Chest Pain</option>
      <option value="allergic_reaction_001">Allergic Reaction</option>
      <!-- Add more scenarios here -->
    </select>
    <br>
    <button id="start-btn" disabled>Start Scenario</button>
  </div>
  <script>
    let scenario = "";
    let scenarioStarted = false;

    document.getElementById('scenario-select').addEventListener('change', function() {
      scenario = this.value;
      document.getElementById('start-btn').disabled = !scenario;
    });

    document.getElementById('start-btn').onclick = function() {
      scenarioStarted = true;
      // Set global variable for scenario
      window.selectedScenario = scenario;
      // Hide landing, show UI
      document.getElementById('landing').style.display = 'none';
      document.getElementById('header').style.display = '';
      document.getElementById('input-bar').style.display = '';
      document.getElementById('skill-sheet-btn').style.display = '';

      // -- CALL THE SAME FUNCTION AS YOUR COMPUTER VERSION! --
      // Prefer startScenarioLogic if you use that on desktop:
      if (typeof window.startScenarioLogic === "function") {
        window.startScenarioLogic(scenario); // RECOMMENDED: most modern setups
      } else if (typeof window.startScenario === "function") {
        window.startScenario(scenario);      // Fallback for classic setups
      } else {
        alert("Scenario loader function not found in app.js!");
      }

      // Update header
      document.getElementById('scenario-title').innerText =
        scenario.replace(/_/g, ' ').replace(/\d+$/, '').toUpperCase();
    };

    // Skill sheet helpers, mic, and send input logic (same as before)
    // ... (your existing JS for these; unchanged from desktop)
    function showSkillSheet() { document.getElementById('skill-sheet-panel').style.display = 'block'; }
    function closeSkillSheet() { document.getElementById('skill-sheet-panel').style.display = 'none'; }
    function addBubble(text, role) {
      const bubble = document.createElement('div');
      bubble.className = `bubble ${role}`;
      bubble.innerText = text;
      document.getElementById('chat').appendChild(bubble);
      document.getElementById('chat').scrollTop = 99999;
    }
    async function sendInput() {
      const input = document.getElementById('user-input');
      const userText = input.value.trim();
      if (!userText) return;
      addBubble(userText, 'user');
      input.value = '';
      if (typeof window.handleUserInput === "function") {
        window.handleUserInput(userText);
      }
      setTimeout(renderSkillSheet, 700);
    }
    document.getElementById('user-input').addEventListener('keydown', e => {
      if (e.key === 'Enter') sendInput();
    });
    function startMic() {
      if (typeof window.handleMicInput === "function") {
        window.handleMicInput();
      } else {
        addBubble("[Voice input coming soon]", "system");
      }
    }
    // ... renderSkillSheet and other helpers (as in your desktop index)
  </script>
</body>
</html>
