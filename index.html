<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EMS Code Sim</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f3f8fb;}
    .main { display:flex; flex-direction:row; min-height:100vh;}
    #simPane { flex:1; padding:24px; display:flex; flex-direction:column; }
    #chat-box { height:340px; overflow-y:auto; background:#fff; border:1px solid #ddd; padding:12px; margin-bottom:16px; border-radius:8px;}
    #input-form { display:flex; gap:8px; }
    #user-input { flex:1; font-size:16px; border-radius:6px; border:1px solid #bbb; padding:7px;}
    .message { margin-bottom:9px; }
    .message.user { color:#1b6ac9;}
    .message.ai { color:#17964a;}
    .message.system { color:#c15e13;}
    .question { margin-top:10px; font-weight:bold;}
    .response { margin-left:16px; }
    .proctor-bubble { color:#874ad7; }
    .patient-bubble { color:#187944; }
    .btns { margin-bottom:14px; }
    button { font-size:15px; border-radius:6px; border:1px solid #187944; padding:7px 14px; margin-right:6px; background:#e9f7ef;}
    button#start-button { background:#1b6ac9; color:#fff; border:none; }
    button#end-button { background:#d63434; color:#fff; border:none; }
    button#mic-button { background:#f3d74c; color:#111; border:none;}
    #learningModeToggle { margin-right:4px; vertical-align:middle;}
    .learning-pane { width:330px; background:#fff; padding:20px 20px 0 20px; border-left:2px solid #e2e2e2; }
    #skillSheetPane { display:none;}
    .skill-table { width:100%; font-size:14px; border-collapse:collapse; }
    .skill-table th, .skill-table td { border-bottom:1px solid #eee; padding:5px 4px;}
    .skill-table th { background:#e7e7fa;}
    .skill-table td { background:#fcfcff;}
    .status-cell { text-align:center; font-size:17px;}
    .checked { color:green; }
    @media (max-width:900px) {
      .main { flex-direction:column; }
      .learning-pane { width:100%; border-left:none; border-top:2px solid #e2e2e2;}
    }
  </style>
</head>
<body>
<div class="main">
  <!-- Simulator/chat pane -->
  <div id="simPane">
    <div class="btns">
      <button id="start-button">Start Scenario</button>
      <button id="end-button">End Scenario</button>
      <button id="mic-button">ðŸŽ¤ Mic</button>
      <label style="float:right;">
        <input type="checkbox" id="learningModeToggle"/>
        Learning Mode
      </label>
    </div>
    <div id="chat-box"></div>
    <form id="input-form" autocomplete="off">
      <input id="user-input" placeholder="Type your assessment or treatment..." autocomplete="off" />
      <button id="send-button" type="submit">Send</button>
    </form>
  </div>
  <!-- Live Skill Sheet pane -->
  <div class="learning-pane" id="skillSheetPane">
    <h3>NREMT Medical Assessment Skill Sheet</h3>
    <table class="skill-table">
      <tr><th>#</th><th>Skill/Assessment Step</th><th>Status</th></tr>
      <tr><td>1</td><td>Takes/verbalizes appropriate PPE precautions</td><td class="status-cell" id="status-1"></td></tr>
      <tr><td>2</td><td>Determines the scene/situation is safe</td><td class="status-cell" id="status-2"></td></tr>
      <tr><td>3</td><td>Determines the mechanism of injury/nature of illness</td><td class="status-cell" id="status-3"></td></tr>
      <tr><td>4</td><td>Determines the number of patients</td><td class="status-cell" id="status-4"></td></tr>
      <tr><td>5</td><td>Requests additional EMS assistance if necessary</td><td class="status-cell" id="status-5"></td></tr>
      <tr><td>6</td><td>Considers stabilization of spine as indicated</td><td class="status-cell" id="status-6"></td></tr>
      <tr><td>7</td><td>Verbalizes general impression of the patient</td><td class="status-cell" id="status-7"></td></tr>
      <tr><td>8</td><td>Determines responsiveness/level of consciousness</td><td class="status-cell" id="status-8"></td></tr>
      <tr><td>9</td><td>Determines chief complaint/apparent life-threats</td><td class="status-cell" id="status-9"></td></tr>
      <tr><td>10</td><td>Airway: Opens, assesses, adjunct, breathing, ventilation, injury management</td><td class="status-cell" id="status-10"></td></tr>
      <tr><td>11</td><td>Initiates appropriate oxygen therapy</td><td class="status-cell" id="status-11"></td></tr>
      <tr><td>12</td><td>Circulation: Checks pulse, skin, controls bleeding, shock management</td><td class="status-cell" id="status-12"></td></tr>
      <tr><td>13</td><td>Identifies patient priority and makes transport/scene decision</td><td class="status-cell" id="status-13"></td></tr>
      <tr><td>14</td><td>Obtains history of present illness (OPQRST)</td><td class="status-cell" id="status-14"></td></tr>
      <tr><td>20</td><td>Obtains past medical history (SAMPLE)</td><td class="status-cell" id="status-20"></td></tr>
      <tr><td>26</td><td>Secondary assessment (head, neck, chest, abdomen, extremities, posterior)</td><td class="status-cell" id="status-26"></td></tr>
      <tr><td>27</td><td>Obtains baseline vital signs (BP, pulse, respirations)</td><td class="status-cell" id="status-27"></td></tr>
      <tr><td>30</td><td>Verbalizes field impression of patient</td><td class="status-cell" id="status-30"></td></tr>
      <tr><td>31</td><td>Verbalizes interventions/treatment & manages secondary injuries</td><td class="status-cell" id="status-31"></td></tr>
      <tr><td>32</td><td>Reassesses patient & gives accurate handoff report</td><td class="status-cell" id="status-32"></td></tr>
    </table>
    <div style="color:#aaa; font-size:12px; margin-top:12px;">
      Each box checks off when you complete that skill sheet item.
    </div>
  </div>
</div>

<!-- Live skill sheet tracking by skillSheetID -->
<script type="module">
  // Map skillSheetID to checklist status element IDs
  const skillSheetIDToStatusID = {
    verbalizesPPEPrecautions: "status-1",
    verbalizesSceneSafety: "status-2",
    determinesMOIorNOI: "status-3",
    determinesNumberOfPatients: "status-4",
    requestsAdditionalEMS: "status-5",
    considersCSpineStabilization: "status-6",
    verbalizesGeneralImpression: "status-7",
    determinesResponsiveness: "status-8",
    determinesChiefComplaint: "status-9",
    assessesAirway: "status-10",
    assessesBreathing: "status-10",
    insertsAirwayAdjunct: "status-10",
    assuresAdequateVentilation: "status-10",
    initiatesOxygenTherapy: "status-11",
    managesInjuryBreathing: "status-10",
    assessesPulse: "status-12",
    assessesSkin: "status-12",
    assessesAndControlsBleeding: "status-12",
    initiatesShockManagement: "status-12",
    identifiesPriorityTransportDecision: "status-13",
    obtainsOPQRSTHistory: "status-14",
    obtainsSAMPLEHistory: "status-20",
    assessesHead: "status-26",
    assessesNeck: "status-26",
    assessesChest: "status-26",
    assessesAbdomenPelvis: "status-26",
    assessesLowerExtremities: "status-26",
    assessesUpperExtremities: "status-26",
    assessesPosterior: "status-26",
    obtainsBaselineVitals: "status-27",
    managesSecondaryInjuries: "status-31",
    verbalizesFieldImpression: "status-30",
    verbalizesInterventions: "status-31",
    reassessesPatient: "status-32",
    providesAccurateHandoffReport: "status-32"
  };

  window.markSkillSheetStep = function (skillSheetID) {
    const statusId = skillSheetIDToStatusID[skillSheetID];
    if (!statusId) return;
    const el = document.getElementById(statusId);
    if (el && !el.textContent.includes("âœ”")) {
      el.textContent = "âœ”";
      el.classList.add("checked");
    }
  };

  window.onResponseScored = function(entry) {
    if (entry.skillSheetID) {
      window.markSkillSheetStep(entry.skillSheetID);
    }
  };

  // Learning Mode toggle logic (show/hide skill sheet pane)
  document.addEventListener("DOMContentLoaded", function () {
    const toggle = document.getElementById("learningModeToggle");
    const skillPane = document.getElementById("skillSheetPane");
    if (toggle && skillPane) {
      toggle.addEventListener("change", () => {
        document.body.classList.toggle("learning-mode", toggle.checked);
        skillPane.style.display = toggle.checked ? "block" : "none";
      });
      if (toggle.checked) skillPane.style.display = "block";
    }
  });
</script>
</body>
</html>
