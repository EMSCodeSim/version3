<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Review Responses</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body { font-family: Arial; padding: 10px; background: #f0f0f0; }
    button { margin: 5px; }
    textarea { width: 100%; height: 60px; }
    select, input { width: 100%; margin-top: 5px; }
    .entry { background: white; padding: 10px; margin: 10px 0; border-radius: 8px; box-shadow: 1px 1px 5px #ccc; }
  </style>
</head>
<body>
  <h2>Review Hardcoded Responses</h2>
  <button onclick="loadFirebase()">Load Firebase</button>
  <button onclick="loadNetlify()">Load Netlify</button>
  <button onclick="loadBoth()">Load Both</button>
  <button onclick="removeDuplicates()">Remove Duplicates</button>
  <input type="text" id="netlifyFolder" placeholder="e.g., chest_pain_002">
  <div id="output"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCEXAMPLEKEY123",
      authDomain: "yourapp.firebaseapp.com",
      databaseURL: "https://yourapp.firebaseio.com",
      projectId: "yourapp",
      storageBucket: "yourapp.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:abc123"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const seenKeys = new Set();

    function createEntry(id, data, source = "firebase") {
      if (seenKeys.has(data.question + data.answer)) return;
      seenKeys.add(data.question + data.answer);

      const div = document.createElement("div");
      div.className = "entry";
      div.innerHTML = `
        <strong>Source:</strong> ${source}<br>
        <label>Question:</label><textarea>${data.question || ""}</textarea>
        <label>Answer:</label><textarea>${data.answer || ""}</textarea>
        <label>Tags (comma-separated):</label><input value="${(data.tags || []).join(", ")}">
        <label>Role:</label>
        <select>
          <option ${data.role === "patient" ? "selected" : ""}>patient</option>
          <option ${data.role === "proctor" ? "selected" : ""}>proctor</option>
        </select>
        <label>SkillSheet ID:</label>
        <select>
          ${Array.from({length: 32}, (_, i) => {
            const n = i + 1;
            const id = `EMT-B-MED-${n}`;
            const label = {
              1: "BSI/PPE", 2: "Scene Safety", 3: "Determine MOI/NOI", 4: "Determine Number of Patients", 5: "Request Additional EMS Assistance",
              6: "Consider C-Spine Stabilization", 7: "General Impression", 8: "Determine Responsiveness/LOC", 9: "Determine Chief Complaint",
              10: "Assess Airway/Breathing", 11: "Initiate Oxygen Therapy", 12: "Assess Circulation", 13: "Identify Priority & Transport",
              14: "OPQRST - Onset", 15: "Provocation", 16: "Quality", 17: "Radiation", 18: "Severity", 19: "Time",
              20: "SAMPLE - Signs/Symptoms", 21: "Allergies", 22: "Medications", 23: "Past Medical History", 24: "Last Oral Intake",
              25: "Events Leading to Present Illness", 26: "Assess Affected Body/System", 27: "Vital Signs - BP", 28: "Heart Rate",
              29: "Respiratory Rate", 30: "Field Impression", 31: "Interventions", 32: "Reassess"
            }[n];
            return `<option value="${id}" ${data.skillSheetID === id ? "selected" : ""}>${id} - ${label}</option>`;
          }).join("")}
        </select><br>
        <button onclick="deleteEntry('${id}')">Delete</button>
        <button onclick="saveEntry(this, '${id}')">Save</button>
      `;
      document.getElementById("output").appendChild(div);
    }

    function loadFirebase() {
      seenKeys.clear();
      document.getElementById("output").innerHTML = "";
      db.ref("gpt4turbo_logs").once("value", snap => {
        const val = snap.val();
        for (let id in val) createEntry(id, val[id], "firebase");
      });
    }

    function loadNetlify() {
      seenKeys.clear();
      document.getElementById("output").innerHTML = "";
      const folder = document.getElementById("netlifyFolder").value.trim();
      if (!folder) return alert("Enter folder name (e.g., chest_pain_002)");
      fetch(`https://emscodesim3.netlify.app/scenarios/${folder}/ems_database_part1.json`)
        .then(res => res.json())
        .then(data => {
          Object.entries(data).forEach(([id, entry]) => createEntry(id, entry, "netlify"));
        }).catch(err => alert("Failed to load Netlify JSON"));
    }

    function loadBoth() {
      loadFirebase();
      setTimeout(loadNetlify, 1000);
    }

    function removeDuplicates() {
      const seen = new Set();
      const entries = [...document.querySelectorAll(".entry")];
      entries.forEach(div => {
        const q = div.querySelector("textarea").value.trim();
        const a = div.querySelectorAll("textarea")[1].value.trim();
        const key = q + a;
        if (seen.has(key)) div.remove();
        else seen.add(key);
      });
    }

    function saveEntry(btn, id) {
      const div = btn.parentElement;
      const [q, a] = div.querySelectorAll("textarea");
      const tags = div.querySelector("input").value.split(",").map(x => x.trim());
      const role = div.querySelectorAll("select")[0].value;
      const skill = div.querySelectorAll("select")[1].value;
      const data = {
        question: q.value.trim(),
        answer: a.value.trim(),
        tags,
        role,
        skillSheetID: skill
      };
      db.ref("gpt4turbo_logs/" + id).set(data);
      alert("Saved to Firebase");
    }

    function deleteEntry(id) {
      db.ref("gpt4turbo_logs/" + id).remove();
      alert("Deleted from Firebase");
    }
  </script>
</body>
</html>
