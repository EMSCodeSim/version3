<!DOCTYPE html>
<html>
<head>
  <title>Database Entry Editor</title>
  <style>
    body { font-family: Arial; }
    .entry { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
    select, input { margin-top: 5px; }
    button { margin-right: 5px; }
  </style>
</head>
<body>
  <h1>EMS Database Entries</h1>
  <div id="entryContainer"></div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getDatabase, ref, get, update, remove } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

    const firebaseConfig = {
      databaseURL: "https://ems-code-sim-a315a-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const SKILLS = [
      { id: "EMT-B-MED-1", label: "BSI/PPE" },
      { id: "EMT-B-MED-2", label: "Scene Safety" },
      { id: "EMT-B-MED-3", label: "Determine MOI/NOI" },
      { id: "EMT-B-MED-4", label: "Determine Number of Patients" },
      { id: "EMT-B-MED-5", label: "Request Additional EMS Assistance" },
      { id: "EMT-B-MED-6", label: "Consider C-Spine Stabilization" },
      { id: "EMT-B-MED-7", label: "General Impression" },
      { id: "EMT-B-MED-8", label: "Determine Responsiveness/LOC" },
      { id: "EMT-B-MED-9", label: "Determine Chief Complaint" },
      { id: "EMT-B-MED-10", label: "Assess Airway/Breathing" },
      { id: "EMT-B-MED-11", label: "Initiate Oxygen Therapy" },
      { id: "EMT-B-MED-12", label: "Assess Circulation (Pulse, Skin, Bleeding)" },
      { id: "EMT-B-MED-13", label: "Identify Patient Priority & Transport Decision" },
      { id: "EMT-B-MED-14", label: "OPQRST - Onset" },
      { id: "EMT-B-MED-15", label: "Provocation" },
      { id: "EMT-B-MED-16", label: "Quality" },
      { id: "EMT-B-MED-17", label: "Radiation" },
      { id: "EMT-B-MED-18", label: "Severity" },
      { id: "EMT-B-MED-19", label: "Time" },
      { id: "EMT-B-MED-20", label: "SAMPLE - Signs/Symptoms" },
      { id: "EMT-B-MED-21", label: "Allergies" },
      { id: "EMT-B-MED-22", label: "Medications" },
      { id: "EMT-B-MED-23", label: "Past Medical History" },
      { id: "EMT-B-MED-24", label: "Last Oral Intake" },
      { id: "EMT-B-MED-25", label: "Events Leading to Present Illness" },
      { id: "EMT-B-MED-26", label: "Assess Affected Body/System" },
      { id: "EMT-B-MED-27", label: "Vital Signs - BP" },
      { id: "EMT-B-MED-28", label: "Heart Rate" },
      { id: "EMT-B-MED-29", label: "Respiratory Rate" },
      { id: "EMT-B-MED-30", label: "Field Impression of Patient" },
      { id: "EMT-B-MED-31", label: "Interventions" },
      { id: "EMT-B-MED-32", label: "Demonstrate How & When to Reassess" }
    ];

    async function loadEntries() {
      const entriesRef = ref(db, 'gpt4turbo_logs/chest_pain_002');
      const snapshot = await get(entriesRef);
      const entries = snapshot.val();
      const container = document.getElementById('entryContainer');
      container.innerHTML = '';

      if (!entries) {
        container.innerText = 'No entries found.';
        return;
      }

      Object.entries(entries).forEach(([id, data]) => {
        const div = document.createElement('div');
        div.className = 'entry';
        div.innerHTML = `
          <b>Question:</b> <input value="${data.question || ''}" id="q-${id}"><br>
          <b>Answer:</b> <input value="${data.answer || ''}" id="a-${id}"><br>
          <b>Role:</b> <input value="${data.role || ''}" id="r-${id}"><br>
          <b>Skill Sheet ID:</b>
          <select id="s-${id}">
            <option value="">-- Select Skill --</option>
            ${SKILLS.map(skill => `<option value="${skill.id}" ${data.skillSheetID === skill.id ? 'selected' : ''}>${skill.label}</option>`).join('')}
          </select><br>
          <button onclick="saveEntry('${id}')">Save</button>
          <button onclick="deleteEntry('${id}')">Delete</button>
        `;
        container.appendChild(div);
      });
    }

    window.saveEntry = async (id) => {
      const question = document.getElementById(`q-${id}`).value;
      const answer = document.getElementById(`a-${id}`).value;
      const role = document.getElementById(`r-${id}`).value;
      const skill = document.getElementById(`s-${id}`).value;
      const entryRef = ref(db, `gpt4turbo_logs/chest_pain_002/${id}`);

      await update(entryRef, { question, answer, role, skillSheetID: skill });
      alert('Entry saved.');
    };

    window.deleteEntry = async (id) => {
      if (confirm('Are you sure you want to delete this entry?')) {
        const entryRef = ref(db, `gpt4turbo_logs/chest_pain_002/${id}`);
        await remove(entryRef);
        alert('Entry deleted.');
        loadEntries();
      }
    };

    loadEntries();
  </script>
</body>
</html>
