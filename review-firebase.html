<!DOCTYPE html>
<html>
<head>
  <title>Load Netlify + Firebase</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body style="font-family:sans-serif;">
  <h2>Combined Entry Loader</h2>

  <button onclick="loadNetlify()">Load All 3 Netlify Files</button>
  <button onclick="loadFirebase()">Load Firebase</button>
  <button onclick="mergeAll()">Merge Databases</button>

  <h3 id="totalCount">Total entries: 0</h3>
  <ul id="output"></ul>

  <script>
    const logs = {
      netlify: [],
      firebase: [],
      merged: []
    };

    // Firebase Config (replace with yours if changed)
    const firebaseConfig = {
      apiKey: "AIzaSyA6XK9-u2zFiCMlqjV6P-bVG8DPJRXF5JE",
      authDomain: "ems-code-sim-a315a.firebaseapp.com",
      databaseURL: "https://ems-code-sim-a315a-default-rtdb.firebaseio.com",
      projectId: "ems-code-sim-a315a",
      storageBucket: "ems-code-sim-a315a.appspot.com",
      messagingSenderId: "223469761761",
      appId: "1:223469761761:web:c16118dbb2f429e5e6e346"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    async function fetchNetlifyFile(url) {
      const res = await fetch(url);
      const json = await res.json();
      return Object.values(json);
    }

    async function loadNetlify() {
      const urls = [
        "https://emscodesim3.netlify.app/scenarios/chest_pain_002/ems_database_part1.json",
        "https://emscodesim3.netlify.app/scenarios/chest_pain_002/ems_database_part2.json",
        "https://emscodesim3.netlify.app/scenarios/chest_pain_002/ems_database_part3.json"
      ];
      logs.netlify = [];
      for (const url of urls) {
        try {
          const entries = await fetchNetlifyFile(url);
          logs.netlify.push(...entries);
        } catch (err) {
          console.error("Netlify load failed:", url, err);
        }
      }
      display(logs.netlify);
    }

    async function loadFirebase() {
      logs.firebase = [];
      try {
        const snap = await db.ref("gpt4turbo_logs").get();
        const data = snap.val() || {};
        for (const scenarioKey in data) {
          const entries = data[scenarioKey];
          if (typeof entries === "object") {
            Object.values(entries).forEach(entry => {
              if (entry?.question && entry?.answer) {
                logs.firebase.push(entry);
              }
            });
          }
        }
        display(logs.firebase);
      } catch (err) {
        console.error("Firebase load error:", err);
      }
    }

    function mergeAll() {
      logs.merged = [...logs.netlify, ...logs.firebase];
      display(logs.merged);
    }

    function display(data) {
      const ul = document.getElementById("output");
      ul.innerHTML = "";
      document.getElementById("totalCount").innerText = "Total entries: " + data.length;
      data.forEach(entry => {
        const li = document.createElement("li");
        li.innerHTML = `<b>Q:</b> ${entry.question}<br><b>A:</b> ${entry.answer}<br><b>Role:</b> ${entry.role || 'unknown'}<hr>`;
        ul.appendChild(li);
      });
    }
  </script>
</body>
</html>
