<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Home</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .response {
      background: #fff;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 0 4px rgba(0,0,0,0.1);
      margin-bottom: 12px;
    }
    .response div[contenteditable] {
      padding: 4px;
      background: #f0f0f0;
      border-radius: 4px;
      margin-bottom: 6px;
    }
    button {
      margin-right: 6px;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <h2>ðŸš€ Admin Review Manager</h2>
  <button onclick="updateAllResponses()">ðŸ›  Update Database</button>
  <div id="responsesContainer"></div>

  <script>
    function renderReviewCard(key, data) {
      const container = document.getElementById("responsesContainer");
      const card = document.createElement("div");
      card.className = "response";
      card.innerHTML = `
        <strong>Question:</strong> <div contenteditable="true" id="q-${key}">${data.question || ''}</div>
        <strong>Response:</strong> <div contenteditable="true" id="r-${key}">${data.response || ''}</div>
        <strong>Score Category:</strong> <div contenteditable="true" id="cat-${key}">${data.scoreCategory || ''}</div>
        <strong>Points:</strong> <div contenteditable="true" id="pts-${key}">${data.points || '1'}</div>
        <strong>Critical Fail:</strong> <div contenteditable="true" id="cf-${key}">${data.criticalFail || 'false'}</div>
        <button onclick="saveReview('${key}')">âœ… Save</button>
        <button onclick="deleteReview('${key}')">ðŸ—‘ Delete</button>
      `;
      container.appendChild(card);
    }

    async function loadReviews() {
      const snap = await db.ref("hardcodedReview").once("value");
      document.getElementById("responsesContainer").innerHTML = "";
      snap.forEach(child => {
        renderReviewCard(child.key, child.val());
      });
    }

    async function saveReview(key) {
      const update = {
        question: document.getElementById(`q-${key}`).innerText,
        response: document.getElementById(`r-${key}`).innerText,
        scoreCategory: document.getElementById(`cat-${key}`).innerText,
        points: parseInt(document.getElementById(`pts-${key}`).innerText),
        criticalFail: document.getElementById(`cf-${key}`).innerText === "true"
      };
      await db.ref(`hardcodedResponses/${key}`).set(update);
      await db.ref(`hardcodedReview/${key}`).remove();
      alert("Saved and moved to hardcodedResponses.");
      location.reload();
    }

    async function deleteReview(key) {
      await db.ref(`hardcodedReview/${key}`).remove();
      alert("Deleted from review list.");
      location.reload();
    }

    async function updateAllResponses() {
      const snap = await db.ref("hardcodedReview").once("value");
      let missingTags = [];
      snap.forEach(child => {
        const val = child.val();
        if (!val.scoreCategory || val.scoreCategory.trim() === "") {
          missingTags.push(child.key);
        }
      });
      if (missingTags.length > 0) {
        alert("The following responses are missing scoreCategory:\n" + missingTags.join("\n"));
      } else {
        alert("All reviewed responses already have score categories.");
      }
    }

    window.onload = loadReviews;
  </script>
</body>
</html>
