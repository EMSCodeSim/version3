<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EMS Code Sim ‚Äì Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 20px; }
    .tabs { display: flex; gap: 20px; margin-bottom: 20px; }
    .tabs button { padding: 10px 20px; cursor: pointer; }
    .response-block {
      background: white;
      padding: 15px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    textarea { width: 100%; height: 60px; }
    select, input[type="text"], input[type="file"] { margin: 5px 0; width: 100%; }
    img { max-height: 100px; margin-top: 5px; }
    audio { width: 100%; margin-top: 5px; }
    .response-block strong { display: inline-block; width: 160px; }
    .response-block button {
      margin-top: 8px;
      margin-right: 10px;
      padding: 6px 10px;
      border: none;
      border-radius: 4px;
      background: #007bff;
      color: white;
      cursor: pointer;
    }
    .response-block button:hover {
      background: #0056b3;
    }
    #update-btn {
      background-color: green;
      color: white;
      font-weight: bold;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
    }
    #update-btn:hover {
      background-color: darkgreen;
    }
  </style>
</head>
<body>
  <h1>EMS Code Sim ‚Äì Admin Panel</h1>

  <div class="tabs">
    <button onclick="switchTab('approved')">‚úÖ Approved</button>
    <button onclick="switchTab('review')">üìù Review</button>
  </div>

  <div>
    <button id="update-btn" onclick="updateAllResponses()">üõ† Update Database (Fill Missing Info)</button>
  </div>

  <div id="response-list">Loading...</div>

  <script type="module" src="/admin_panel.js"></script>

<div id="responseList"></div>

<script>
function renderResponseCard(key, data) {
  const container = document.getElementById("responseList");
  const card = document.createElement("div");
  card.className = "response-card";
  card.innerHTML = `
    <div><strong>Question:</strong> <div contenteditable="true" id="q-${key}">${data.question || ''}</div></div>
    <div><strong>Response:</strong> <div contenteditable="true" id="r-${key}">${data.response || ''}</div></div>
    <div><strong>Score Category:</strong> <div contenteditable="true" id="cat-${key}">${data.scoreCategory || ''}</div></div>
    <div><strong>Points:</strong> <div contenteditable="true" id="pts-${key}">${data.points || '1'}</div></div>
    <div><strong>Critical Fail:</strong> <div contenteditable="true" id="cf-${key}">${data.criticalFail || 'false'}</div></div>
    <button onclick="saveResponse('${key}')">‚úÖ Save</button>
    <button onclick="deleteResponse('${key}')">üóë Delete</button>
  `;
  container.appendChild(card);
}

async function loadReviewResponses() {
  const snap = await db.ref("hardcodedReview").once("value");
  snap.forEach(child => {
    renderResponseCard(child.key, child.val());
  });
}

async function saveResponse(key) {
  const update = {
    question: document.getElementById(`q-${key}`).innerText,
    response: document.getElementById(`r-${key}`).innerText,
    scoreCategory: document.getElementById(`cat-${key}`).innerText,
    points: parseInt(document.getElementById(`pts-${key}`).innerText),
    criticalFail: document.getElementById(`cf-${key}`).innerText === "true"
  };
  await db.ref(`hardcodedResponses/${key}`).set(update);
  await db.ref(`hardcodedReview/${key}`).remove();
  alert("Response saved and moved to hardcodedResponses.");
  location.reload();
}

async function deleteResponse(key) {
  await db.ref(`hardcodedReview/${key}`).remove();
  alert("Deleted from review list.");
  location.reload();
}

window.onload = loadReviewResponses;
</script>

</body>
</html>
