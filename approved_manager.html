<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Approved Hardcoded Responses</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "https://ems-code-sim-default-rtdb.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    async function loadResponses() {
      const container = document.getElementById("responsesContainer");
      container.innerHTML = "Loading approved responses...";
      const snapshot = await db.ref("hardcodedResponses").once("value");
      const data = snapshot.val();

      if (!data) {
        container.innerHTML = "No responses found.";
        return;
      }

      container.innerHTML = "";
      Object.entries(data).forEach(([key, entry]) => {
        const div = document.createElement("div");
        div.className = "entry";
        const roleOptions = `
          <select id="role-${key}" class="role-select">
            <option value="patient" ${entry.role === 'patient' ? 'selected' : ''}>Patient</option>
            <option value="proctor" ${entry.role === 'proctor' ? 'selected' : ''}>Proctor</option>
          </select>
        `;
        div.innerHTML = `
          <strong>Question:</strong> <span>${entry.question || 'undefined'}</span><br/>
          ${roleOptions}<br/>
          <textarea id="text-${key}" rows="3">${entry.text || 'undefined'}</textarea><br/>
          <button onclick="saveResponse('${key}')">Save</button>
        `;
        container.appendChild(div);
      });
    }

    async function saveResponse(key) {
      const newText = document.getElementById(`text-${key}`).value;
      const newRole = document.getElementById(`role-${key}`).value;

      const voice = newRole === "proctor" ? "shimmer" : "onyx";
      const response = await fetch("https://api.openai.com/v1/audio/speech", {
        method: "POST",
        headers: {
          "Authorization": `Bearer YOUR_OPENAI_API_KEY`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "tts-1",
          input: newText,
          voice,
          response_format: "base64"
        })
      });

      const result = await response.json();

      await db.ref("hardcodedResponses/" + key).update({
        text: newText,
        role: newRole,
        ttsAudio: result.audio
      });

      alert("Response updated.");
    }

    window.onload = loadResponses;
  </script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f2f2f2; }
    .entry { background: #fff; border: 1px solid #ccc; padding: 15px; margin-bottom: 15px; }
    textarea { width: 100%; margin-top: 5px; }
    .role-select { margin: 10px 0; }
  </style>
</head>
<body>
  <h2>Approved Hardcoded Responses</h2>
  <div id="responsesContainer">Loading approved responses...</div>
</body>
</html>
